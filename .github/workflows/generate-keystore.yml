name: Generate Upload Keystore

on:
  workflow_dispatch:
    inputs:
      key_alias:
        description: 'Alias for the key (default: upload)'
        required: false
        default: 'upload'
        type: string
      store_password:
        description: 'Keystore password (min 6 chars)'
        required: false
        default: 'android123'
        type: string
      key_password:
        description: 'Key password (min 6 chars)'
        required: false
        default: 'android123'
        type: string
      org_name:
        description: 'Organization name for certificate'
        required: false
        default: 'My Company'
        type: string

jobs:
  generate:
    runs-on: ubuntu-latest
    
    steps:
      - name: Generate Keystore
        run: |
          echo "ğŸ” Generating Upload Keystore..."
          echo ""
          
          keytool -genkey -v \
            -keystore upload-keystore.jks \
            -alias ${{ inputs.key_alias }} \
            -keyalg RSA \
            -keysize 2048 \
            -validity 10000 \
            -storepass ${{ inputs.store_password }} \
            -keypass ${{ inputs.key_password }} \
            -dname "CN=Upload Key, OU=Mobile, O=${{ inputs.org_name }}, L=City, ST=State, C=BR"
          
          echo "âœ… Keystore generated successfully!"

      - name: Convert to Base64
        id: base64
        run: |
          echo "ğŸ“¦ Converting to Base64..."
          BASE64_CONTENT=$(base64 -w 0 upload-keystore.jks)
          echo "base64=$BASE64_CONTENT" >> $GITHUB_OUTPUT

      - name: Display Keystore Base64
        run: |
          echo ""
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "ğŸ”‘ SUA KEYSTORE EM BASE64 (COPIE TUDO ABAIXO)"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          echo "${{ steps.base64.outputs.base64 }}"
          echo ""
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          echo "ğŸ“‹ CONFIGURAÃ‡Ã•ES PARA USAR NOS SECRETS DO GITHUB:"
          echo ""
          echo "â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
          echo "â”‚ Secret Name                     â”‚ Valor                        â”‚"
          echo "â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤"
          echo "â”‚ UPLOAD_KEYSTORE_BASE64          â”‚ (cÃ³digo base64 acima)        â”‚"
          echo "â”‚ UPLOAD_KEYSTORE_PASSWORD        â”‚ ${{ inputs.store_password }} â”‚"
          echo "â”‚ UPLOAD_KEY_ALIAS                â”‚ ${{ inputs.key_alias }}      â”‚"
          echo "â”‚ UPLOAD_KEY_PASSWORD             â”‚ ${{ inputs.key_password }}   â”‚"
          echo "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
          echo ""
          echo "âš ï¸  IMPORTANTE: ApÃ³s copiar, DELETE este workflow run dos logs!"
          echo "    (As senhas ficam visÃ­veis no histÃ³rico)"
          echo ""
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

      - name: Save as artifact (backup)
        uses: actions/upload-artifact@v4
        with:
          name: upload-keystore-backup
          path: upload-keystore.jks
          retention-days: 1
